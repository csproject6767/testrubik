<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Rubik's Pro Terminal</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.9.1/gsap.min.js"></script>

<style>
:root { --neon:#00ff00; --bg:#000; }
* { box-sizing:border-box; }

html,body{
  margin:0;
  padding:0;
  width:100%;
  height:100%;
  background:#000;
  color:var(--neon);
  font-family:"Courier New",monospace;
  overflow:hidden;
}

/* overlay */
#overlay{
  position:fixed;
  inset:0;
  z-index:10;
  background:#000;
  display:flex;
  justify-content:center;
  align-items:center;
}
.page{
  display:none;
  text-align:center;
  border:2px solid var(--neon);
  padding:40px;
  max-width:500px;
  background:#001100;
}
.page.active{display:block;}

.pop-btn{
  background:#000;
  border:2px solid var(--neon);
  color:var(--neon);
  padding:10px 20px;
  margin-top:10px;
  font-weight:bold;
  cursor:pointer;
}
.pop-btn:hover{
  background:var(--neon);
  color:#000;
}

/* main */
#main-app{
  display:none;
  width:100vw;
  height:100vh;
  display:grid;
  grid-template-columns:280px 1fr;
}

#sidebar{
  background:#001000;
  border-right:1px solid var(--neon);
  padding:20px;
}

#cube-container{
  position:relative;
  width:100%;
  height:100%;
  padding:20px;
}

/* camera buttons */
.camera-column{
  position:absolute;
  top:50%;
  left:20px;
  transform:translateY(-50%);
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index:5;
}
.camera-btn{
  width:50px;
  height:50px;
  border:2px solid var(--neon);
  background:#001100;
  color:var(--neon);
  cursor:pointer;
}
.camera-btn:hover{
  background:var(--neon);
  color:#000;
}
</style>
</head>

<body>

<!-- OVERLAY -->
<div id="overlay">
  <div id="p1" class="page active">
    <h1>[ INITIALIZING ]</h1>
    <button class="pop-btn" onclick="goPage('p-method')">Start</button>
  </div>

  <div id="p-method" class="page">
    <h2>Select Method</h2>
    <button class="pop-btn" onclick="initApp('Beginner')">Beginner</button>
    <button class="pop-btn" onclick="initApp('CFOP')">CFOP</button>
  </div>
</div>

<!-- MAIN APP -->
<div id="main-app">
  <div id="sidebar">
    <h2 id="method-title">SYSTEM</h2>
    <button class="pop-btn" onclick="scramble()">Scramble</button>
    <button class="pop-btn" onclick="resetView()">Reset View</button>
  </div>

  <div id="cube-container">

    <!-- CAMERA SNAP BUTTONS -->
    <div class="camera-column">
      <button class="camera-btn" onclick="snapAndReorient('front')">F</button>
      <button class="camera-btn" onclick="snapAndReorient('right')">R</button>
      <button class="camera-btn" onclick="snapAndReorient('back')">B</button>
      <button class="camera-btn" onclick="snapAndReorient('left')">L</button>
      <button class="camera-btn" onclick="snapAndReorient('up')">U</button>
      <button class="camera-btn" onclick="snapAndReorient('down')">D</button>
    </div>

    <!-- MOVE BUTTONS (INLINE AS REQUESTED) -->
    <div style="
      position:absolute;
      left:50%;
      bottom:20px;
      transform:translateX(-50%);
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      justify-content:center;
      z-index:5;
    ">
      <button class="pop-btn" onclick="screenMove('right')">R</button>
      <button class="pop-btn" onclick="screenMove('right_prime')">R'</button>

      <button class="pop-btn" onclick="screenMove('left')">L</button>
      <button class="pop-btn" onclick="screenMove('left_prime')">L'</button>

      <button class="pop-btn" onclick="screenMove('front')">F</button>
      <button class="pop-btn" onclick="screenMove('front_prime')">F'</button>

      <button class="pop-btn" onclick="screenMove('back')">B</button>
      <button class="pop-btn" onclick="screenMove('back_prime')">B'</button>

      <button class="pop-btn" onclick="screenMove('up')">U</button>
      <button class="pop-btn" onclick="screenMove('up_prime')">U'</button>

      <button class="pop-btn" onclick="screenMove('down')">D</button>
      <button class="pop-btn" onclick="screenMove('down_prime')">D'</button>
    </div>

  </div>
</div>

<script>
let scene, camera, renderer;
let cubies = [];
let cubeGroup = new THREE.Group();
let isRotating = false;
let currentTargetFace = 'front';

const standardViews = {
  front:{ cameraPos:[0,3,12], cubeRot:[0,0,0] },
  right:{ cameraPos:[12,3,0], cubeRot:[0,-Math.PI/2,0] },
  back:{ cameraPos:[0,3,-12], cubeRot:[0,Math.PI,0] },
  left:{ cameraPos:[-12,3,0], cubeRot:[0,Math.PI/2,0] },
  up:{ cameraPos:[0,12,3], cubeRot:[-Math.PI/2,0,0] },
  down:{ cameraPos:[0,-12,3], cubeRot:[Math.PI/2,0,0] }
};

function goPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function initApp(method){
  overlay.style.display='none';
  main-app.style.display='grid';
  document.getElementById('method-title').innerText = method+" HUB";
  setup3D();
}

function setup3D(){
  const c = document.getElementById('cube-container');
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(35,c.clientWidth/c.clientHeight,0.1,1000);
  renderer = new THREE.WebGLRenderer({antialias:true,alpha:true});
  renderer.setSize(c.clientWidth,c.clientHeight);
  c.appendChild(renderer.domElement);

  scene.add(new THREE.AmbientLight(0xffffff,0.7));
  const d = new THREE.DirectionalLight(0xffffff,1);
  d.position.set(1,1,1); scene.add(d);

  scene.add(cubeGroup);

  const colors=[0xff0000,0xffa500,0xffffff,0xffff00,0x00ff00,0x0000ff];
  for(let x=-1;x<=1;x++)
  for(let y=-1;y<=1;y++)
  for(let z=-1;z<=1;z++){
    if(x||y||z){
      const mats=colors.map(c=>new THREE.MeshLambertMaterial({color:c}));
      const m=new THREE.Mesh(new THREE.BoxGeometry(0.95,0.95,0.95),mats);
      m.position.set(x,y,z);
      cubies.push(m);
      cubeGroup.add(m);
    }
  }

  snapAndReorient('front');
  animate();
}

function snapAndReorient(face){
  currentTargetFace=face;
  const v=standardViews[face];
  gsap.to(camera.position,{x:v.cameraPos[0],y:v.cameraPos[1],z:v.cameraPos[2],duration:.6});
  gsap.to(cubeGroup.rotation,{x:v.cubeRot[0],y:v.cubeRot[1],z:v.cubeRot[2],duration:.6});
}

function getScreenToWorldMapping(){
  return {right:'x',left:'x',front:'z',back:'z',up:'y',down:'y'};
}

function screenMove(dir){
  if(isRotating) return;
  const prime=dir.includes('prime');
  const base=dir.replace('_prime','');
  const axis=getScreenToWorldMapping()[base];
  const layer=(base==='right'||base==='front'||base==='up')?1:-1;
  rotateLayer(axis,layer,prime);
}

function rotateLayer(axis,layer,prime){
  isRotating=true;
  const pivot=new THREE.Group();
  scene.add(pivot);
  const move=[];
  cubies.forEach(c=>{
    if(Math.round(c.position[axis])===layer){
      pivot.add(c); move.push(c);
    }
  });
  gsap.to(pivot.rotation,{
    [axis]:(prime?1:-1)*Math.PI/2,
    duration:.25,
    onComplete:()=>{
      move.forEach(c=>{
        cubeGroup.add(c);
        c.position.set(Math.round(c.position.x),Math.round(c.position.y),Math.round(c.position.z));
      });
      scene.remove(pivot);
      isRotating=false;
    }
  });
}

function scramble(){
  const m=['right','left','front','back','up','down'];
  let i=0;
  const t=setInterval(()=>{
    if(!isRotating){
      screenMove(m[Math.floor(Math.random()*6)]+(Math.random()>.5?'_prime':''));
      if(++i>20) clearInterval(t);
    }
  },200);
}

function resetView(){ snapAndReorient('front'); }

function animate(){
  requestAnimationFrame(animate);
  camera.lookAt(0,0,0);
  renderer.render(scene,camera);
}
</script>

</body>
</html>
